@baseUrl = http://localhost:3000/api

# =================================================================
# TOKENS
# =================================================================
@token_admin = eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6MSwiZW1haWwiOiJhZG1pbkBjcm0uY29tIiwidXNlcm5hbWUiOiJhZG1pbiIsInJvbGUiOiJBRE1JTiIsImlhdCI6MTc1NDU2MDQ5MSwiZXhwIjoxNzU0NjQ2ODkxfQ.sXZekuDGiHv4_KVqCWM1Hz4bNyAh_bsRjYLIl7VRsfQ
@token_manager = eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6MiwiZW1haWwiOiJtYW5hZ2VyQGNybS5jb20iLCJ1c2VybmFtZSI6Im1hbmFnZXIiLCJyb2xlIjoiTUFOQUdFUiIsImlhdCI6MTc1NDU2MDUyNywiZXhwIjoxNzU0NjQ2OTI3fQ.MitFAC5XKFKW-a-Q5UWVEWjYMSO-acMANuNfKs5V1_w
@token_sales = eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6MywiZW1haWwiOiJzYWxlczFAY3JtLmNvbSIsInVzZXJuYW1lIjoic2FsZXMxIiwicm9sZSI6IlNBTEVTIiwiaWF0IjoxNzU0NTYwNTg3LCJleHAiOjE3NTQ2NDY5ODd9.2ZN-WQdAFyF_6BybSd31GFpD8FLMXPlLtEU1uZQh1aI
@token_sales2 = eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6NCwiZW1haWwiOiJzYWxlczJAY3JtLmNvbSIsInVzZXJuYW1lIjoic2FsZXMyIiwicm9sZSI6IlNBTEVTIiwiaWF0IjoxNzU0NTYwNjA1LCJleHAiOjE3NTQ2NDcwMDV9.WbemKaKO3luLZ_1ldluzfwwmszWq2q2fxL9Z7_gdSho
@token_viewer = eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6NSwiZW1haWwiOiJ2aWV3ZXJAY3JtLmNvbSIsInVzZXJuYW1lIjoidmlld2VyIiwicm9sZSI6IlZJRVdFUiIsImlhdCI6MTc1NDU3NzE3MiwiZXhwIjoxNzU0NjYzNTcyfQ.0RWXzPpemALcQxD6oHUnG7BBSs0WA85ZSPcsOmlEtR0

# =================================================================
# OPPORTUNITY CORE ENDPOINTS
# =================================================================

### [SUCCESS] Sales user creates a new opportunity
# @name createOpportunity
POST {{baseUrl}}/opportunities
Content-Type: application/json
Authorization: Bearer {{token_sales}}

{
  "name": "Peluang Proyek Website Baru",
  "amount": 75000000.00,
  "stage": "QUALIFICATION",
  "closeDate": "2025-12-31T17:00:00.000Z",
  "customerId": 1
}

### ----------------------------------------------------------------

### [SUCCESS] Any authenticated user gets all opportunities
GET {{baseUrl}}/opportunities
Authorization: Bearer {{token_sales}}

### ----------------------------------------------------------------

### [SUCCESS] Any authenticated user gets an opportunity by ID
GET {{baseUrl}}/opportunities/1
Authorization: Bearer {{token_sales}}

### ----------------------------------------------------------------

### [SUCCESS] Manager updates an opportunity
PATCH {{baseUrl}}/opportunities/1
Content-Type: application/json
Authorization: Bearer {{token_manager}}

{
  "stage": "PROPOSAL_PRESENTATION",
  "amount": 80000000.00
}

### ----------------------------------------------------------------

### [FAIL] Sales user tries to delete an opportunity they don't own
DELETE {{baseUrl}}/opportunities/4
Authorization: Bearer {{token_sales2}}

### ----------------------------------------------------------------

### [SUCCESS] Admin deletes an opportunity
# Ganti ID opportunity jika perlu
DELETE {{baseUrl}}/opportunities/2
Authorization: Bearer {{token_admin}}


# =================================================================
# OPPORTUNITY FILTER ENDPOINTS
# =================================================================

### [SUCCESS] Get all opportunities filtered by stage 'QUALIFICATION'
GET {{baseUrl}}/opportunities?stage=QUALIFICATION
Authorization: Bearer {{token_sales}}

### ----------------------------------------------------------------

### [FAIL] Get opportunities with an invalid stage
GET {{baseUrl}}/opportunities?stage=INVALID_STAGE
Authorization: Bearer {{token_sales}}


# =================================================================
# OPPORTUNITY RELATIONSHIP ENDPOINTS
# =================================================================

### [SUCCESS] Any authenticated user gets sales for an opportunity
# Ganti ID dengan opportunity yang memiliki sales
GET {{baseUrl}}/opportunities/1/sales
Authorization: Bearer {{token_sales}}

### ----------------------------------------------------------------

### [SUCCESS] Manager gets activities for an opportunity
# Ganti ID dengan opportunity yang memiliki activities
GET {{baseUrl}}/opportunities/1/activities
Authorization: Bearer {{token_manager}}

### ----------------------------------------------------------------

### [FAIL] Sales user tries to get activities for an opportunity (not allowed by policy)
GET {{baseUrl}}/opportunities/1/activities
Authorization: Bearer {{token_sales}}

### ----------------------------------------------------------------

### [SUCCESS] Manager gets notes for an opportunity
# Ganti ID dengan opportunity yang memiliki notes
GET {{baseUrl}}/opportunities/1/notes
Authorization: Bearer {{token_manager}}

### ----------------------------------------------------------------

### [FAIL] Sales user tries to get notes for an opportunity (not allowed by policy)
GET {{baseUrl}}/opportunities/1/notes
Authorization: Bearer {{token_sales}}